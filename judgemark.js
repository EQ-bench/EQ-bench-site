const leaderboardDataJudgemark = `
# gpt-4-0125-preview:

71.49 gpt-4-0125-preview
69.69 claude-3-opus-20240229
68.5 claude-3-sonnet-20240229
67.13 claude-3-haiku-20240307
62.79 mistral-small
68.29 mistral-medium
69.12 mistral-large-2402
53.08 gpt-3.5-turbo-0301
66.88 01-ai/Yi-34B-Chat
63.66 openchat/openchat-3.5-1210
55.64 garage-bAInd/Platypus2-70B-instruct
65.89 mistralai/Mixtral-8x7B-Instruct-v0.1
65.5 Qwen/Qwen1.5-14B-Chat
36.49 Qwen/Qwen1.5-4B-Chat
51.98 google/gemma-2b-it
55.01 google/gemma-7b-it
53.79 meta-llama/Llama-2-7b-chat-hf
56.52 meta-llama/Llama-2-13b-chat-hf
68.55 sophosympatheia/Midnight-Miqu-70B-v1.5
normalised:
std_dev 0.5920466654420735
avg_kendalls 0.6498599439775911
avg_pearsons 0.8022818617482712
mean_score 61.578947368421055
range 34.99999999999999
std_dev 8.880699981631103
CV 0.1442164954281974
std_dev_top_5 1.2286781515107994
pearson_arena_elo 0.8489759877730771
kendall_arena_elo 0.8095238095238096
pearson_eq_bench 0.8377546150524986
kendall_eq_bench 0.6470588235294118
pearson_top_8_arena_elo 0.7867652770650644
kendall_top_8_arena_elo 0.6190476190476191
pearson_top_8_eq_bench 0.7356315671024446
kendall_top_8_eq_bench 0.5238095238095238
aggregate_score 68.13961570559786
----judgemark Benchmark Complete----
2024-04-04 15:26:16
Time taken: 0.0 mins
Judge: gpt-4-0125-preview
Final Judgemark Benchmark Results:
Mean Score: 61.58
Std. Dev.: 8.88
Judgemark Score: 68.14
Cost: $16.00


# gpt-3.5-turbo-0125

63.98 gpt-4-0125-preview
65.57 claude-3-opus-20240229
63.56 claude-3-sonnet-20240229
64.65 claude-3-haiku-20240307
62.6 mistral-small
63.39 mistral-medium
63.47 mistral-large-2402
59.53 gpt-3.5-turbo-0301
66.71 01-ai/Yi-34B-Chat
63.18 openchat/openchat-3.5-1210
59.15 garage-bAInd/Platypus2-70B-instruct
63.87 mistralai/Mixtral-8x7B-Instruct-v0.1
65.6 Qwen/Qwen1.5-14B-Chat
55.33 Qwen/Qwen1.5-4B-Chat
61.79 google/gemma-2b-it
60.45 google/gemma-7b-it
61.47 meta-llama/Llama-2-7b-chat-hf
60.64 meta-llama/Llama-2-13b-chat-hf
66.01 sophosympatheia/Midnight-Miqu-70B-v1.5
normalised:
std_dev 0.18668707073112378
avg_kendalls 0.1451680672268908
avg_pearsons 0.20225699415942852
mean_score 62.68157894736842
range 11.379999999999995
std_dev 2.800306060966857
CV 0.04467510404162247
std_dev_top_5 0.7492129203370664
pearson_arena_elo 0.6855738008507067
kendall_arena_elo 0.561904761904762
pearson_eq_bench 0.6293986924598087
kendall_eq_bench 0.3235294117647059
pearson_top_8_arena_elo -0.28621629129984877
kendall_top_8_arena_elo -0.06666666666666665
pearson_top_8_eq_bench -0.2197282253729528
kendall_top_8_eq_bench -0.23809523809523814
aggregate_score 17.803737737248106
----judgemark Benchmark Complete----
2024-04-04 15:25:34
Time taken: 0.0 mins
Judge: gpt-3.5-turbo-0125
Final Judgemark Benchmark Results:
Mean Score: 62.68
Std. Dev.: 2.8
Judgemark Score: 17.8
Cost: $0.96


# claude-3-haiku

83.67 gpt-4-0125-preview
82.96 claude-3-opus-20240229
82.69 claude-3-sonnet-20240229
82.86 claude-3-haiku-20240307
81.32 mistral-small
81.08 mistral-medium
82.6 mistral-large-2402
77.27 gpt-3.5-turbo-0301
83.9 01-ai/Yi-34B-Chat
81.22 openchat/openchat-3.5-1210
78.83 garage-bAInd/Platypus2-70B-instruct
81.17 mistralai/Mixtral-8x7B-Instruct-v0.1
81.97 Qwen/Qwen1.5-14B-Chat
63.34 Qwen/Qwen1.5-4B-Chat
79.03 google/gemma-2b-it
79.28 google/gemma-7b-it
78.48 meta-llama/Llama-2-7b-chat-hf
78.1 meta-llama/Llama-2-13b-chat-hf
83.63 sophosympatheia/Midnight-Miqu-70B-v1.5
normalised:
std_dev 0.3045290956714338
avg_kendalls 0.2713235294117647
avg_pearsons 0.27961586749798784
mean_score 80.17894736842106
range 20.560000000000002
std_dev 4.567936435071507
CV 0.05697176858760577
std_dev_top_5 0.4639288738589167
pearson_arena_elo 0.6664676372888624
kendall_arena_elo 0.580952380952381
pearson_eq_bench 0.6754048870752009
kendall_eq_bench 0.48529411764705876
pearson_top_8_arena_elo -0.20172509316612589
kendall_top_8_arena_elo 0.06666666666666665
pearson_top_8_eq_bench -0.02168396120598602
kendall_top_8_eq_bench -0.04761904761904762
aggregate_score 28.51561641937288
----judgemark Benchmark Complete----
2024-04-04 15:22:13
Time taken: 0.0 mins
Judge: claude-3-haiku-20240307
Final Judgemark Benchmark Results:
Mean Score: 80.18
Std. Dev.: 4.57
Judgemark Score: 28.52
Cost: $0.60

# claude-3-sonnet

80.09 gpt-4-0125-preview
77.1 claude-3-opus-20240229
77.21 claude-3-sonnet-20240229
75.18 claude-3-haiku-20240307
76.21 mistral-small
74.69 mistral-medium
76.46 mistral-large-2402
63.97 gpt-3.5-turbo-0301
77.37 01-ai/Yi-34B-Chat
71.34 openchat/openchat-3.5-1210
71.29 garage-bAInd/Platypus2-70B-instruct
75.34 mistralai/Mixtral-8x7B-Instruct-v0.1
74.33 Qwen/Qwen1.5-14B-Chat
48.78 Qwen/Qwen1.5-4B-Chat
66.84 google/gemma-2b-it
70.78 google/gemma-7b-it
68.4 meta-llama/Llama-2-7b-chat-hf
68.0 meta-llama/Llama-2-13b-chat-hf
77.25 sophosympatheia/Midnight-Miqu-70B-v1.5
normalised:
std_dev 0.4734557099579092
avg_kendalls 0.392296918767507
avg_pearsons 0.6320250209272269
mean_score 72.13842105263159
range 31.310000000000002
std_dev 7.101835649368638
CV 0.09844733979119391
std_dev_top_5 1.2815537444836274
pearson_arena_elo 0.7601586907016281
kendall_arena_elo 0.6380952380952382
pearson_eq_bench 0.7583197440869085
kendall_eq_bench 0.588235294117647
pearson_top_8_arena_elo 0.6096666056920135
kendall_top_8_arena_elo 0.2
pearson_top_8_eq_bench 0.39995504322835723
kendall_top_8_eq_bench 0.14285714285714288
aggregate_score 49.9259216550881
----judgemark Benchmark Complete----
2024-04-04 15:20:07
Time taken: 0.0 mins
Judge: claude-3-sonnet-20240229
Final Judgemark Benchmark Results:
Mean Score: 72.14
Std. Dev.: 7.1
Judgemark Score: 49.93
Cost: $15.00

# claude-3-opus

74.97 gpt-4-0125-preview
76.81 claude-3-opus-20240229
76.23 claude-3-sonnet-20240229
73.91 claude-3-haiku-20240307
63.99 mistral-small
69.87 mistral-medium
70.48 mistral-large-2402
50.97 gpt-3.5-turbo-0301
67.14 01-ai/Yi-34B-Chat
56.08 openchat/openchat-3.5-1210
51.19 garage-bAInd/Platypus2-70B-instruct
68.21 mistralai/Mixtral-8x7B-Instruct-v0.1
67.13 Qwen/Qwen1.5-14B-Chat
35.33 Qwen/Qwen1.5-4B-Chat
37.78 google/gemma-2b-it
50.07 google/gemma-7b-it
48.27 meta-llama/Llama-2-7b-chat-hf
55.47 meta-llama/Llama-2-13b-chat-hf
76.41 sophosympatheia/Midnight-Miqu-70B-v1.5
normalised:
std_dev 0.8763675132007304
avg_kendalls 0.6271358543417367
avg_pearsons 0.7005693863835505
mean_score 61.59526315789475
range 41.480000000000004
std_dev 13.145512698010956
CV 0.21341759128966523
std_dev_top_5 1.1987827159247852
pearson_arena_elo 0.9321532547758339
kendall_arena_elo 0.9238095238095239
pearson_eq_bench 0.8595994993579341
kendall_eq_bench 0.6323529411764706
pearson_top_8_arena_elo 0.9045311880517819
kendall_top_8_arena_elo 0.9047619047619049
pearson_top_8_eq_bench 0.1059936033486515
kendall_top_8_eq_bench 0.04761904761904762
aggregate_score 73.46909179753392
----judgemark Benchmark Complete----
2024-04-04 15:20:44
Time taken: 0.0 mins
Judge: claude-3-opus-20240229
Final Judgemark Benchmark Results:
Mean Score: 61.6
Std. Dev.: 13.15
Judgemark Score: 73.47
Cost: $40.00

# mistral-large

76.14 gpt-4-0125-preview
77.87 claude-3-opus-20240229
77.71 claude-3-sonnet-20240229
79.23 claude-3-haiku-20240307
77.71 mistral-small
77.75 mistral-medium
78.95 mistral-large-2402
70.69 gpt-3.5-turbo-0301
74.64 01-ai/Yi-34B-Chat
73.32 openchat/openchat-3.5-1210
69.71 garage-bAInd/Platypus2-70B-instruct
76.99 mistralai/Mixtral-8x7B-Instruct-v0.1
75.83 Qwen/Qwen1.5-14B-Chat
48.32 Qwen/Qwen1.5-4B-Chat
61.15 google/gemma-2b-it
71.06 google/gemma-7b-it
65.5 meta-llama/Llama-2-7b-chat-hf
70.49 meta-llama/Llama-2-13b-chat-hf
79.55 sophosympatheia/Midnight-Miqu-70B-v1.5
normalised:
std_dev 0.5152802375376734
avg_kendalls 0.5077569941881164
avg_pearsons 0.39931883341312974
mean_score 72.76894736842105
range 31.229999999999997
std_dev 7.729203563065101
CV 0.10621568460971419
std_dev_top_5 0.8143709228600924
pearson_arena_elo 0.7908538030644875
kendall_arena_elo 0.7333333333333334
pearson_eq_bench 0.86939963745214
kendall_eq_bench 0.6715912882012389
pearson_top_8_arena_elo 0.17803574640432773
kendall_top_8_arena_elo 0.3333333333333333
pearson_top_8_eq_bench -0.24101385326843625
kendall_top_8_eq_bench 0.29277002188455997
aggregate_score 47.41186883796398
----judgemark Benchmark Complete----
2024-04-04 15:23:14
Time taken: 0.0 mins
Judge: mistral-large-2402
Final Judgemark Benchmark Results:
Mean Score: 72.77
Std. Dev.: 7.73
Judgemark Score: 47.41
Cost: $21.14


# mistral-small

76.38 gpt-4-0125-preview
73.3 claude-3-opus-20240229
76.4 claude-3-sonnet-20240229
73.67 claude-3-haiku-20240307
67.89 mistral-small
73.46 mistral-medium
72.85 mistral-large-2402
61.32 gpt-3.5-turbo-0301
79.96 01-ai/Yi-34B-Chat
66.56 openchat/openchat-3.5-1210
64.66 garage-bAInd/Platypus2-70B-instruct
71.99 mistralai/Mixtral-8x7B-Instruct-v0.1
71.48 Qwen/Qwen1.5-14B-Chat
47.27 Qwen/Qwen1.5-4B-Chat
61.26 google/gemma-2b-it
62.2 google/gemma-7b-it
58.09 meta-llama/Llama-2-7b-chat-hf
65.53 meta-llama/Llama-2-13b-chat-hf
75.6 sophosympatheia/Midnight-Miqu-70B-v1.5
normalised:
std_dev 0.5330793059749546
avg_kendalls 0.1501050420168067
avg_pearsons 0.24489456315472696
mean_score 68.41421052631578
range 32.68999999999999
std_dev 7.9961895896243185
CV 0.11687907421731562
std_dev_top_5 2.2785346168096696
pearson_arena_elo 0.7933013262373004
kendall_arena_elo 0.6571428571428571
pearson_eq_bench 0.7785158193641045
kendall_eq_bench 0.5147058823529411
pearson_top_8_arena_elo -0.3446876758883198
kendall_top_8_arena_elo -0.14285714285714288
pearson_top_8_eq_bench -0.24755121709417743
kendall_top_8_eq_bench -0.4285714285714286
aggregate_score 30.93596370488294
----judgemark Benchmark Complete----
2024-04-04 15:24:21
Time taken: 0.7 mins
Judge: mistral-small
Final Judgemark Benchmark Results:
Mean Score: 68.41
Std. Dev.: 8.0
Judgemark Score: 30.94
Cost: $1.30


# mistral-medium

76.88 gpt-4-0125-preview
74.3 claude-3-opus-20240229
72.77 claude-3-sonnet-20240229
73.25 claude-3-haiku-20240307
72.18 mistral-small
75.33 mistral-medium
76.32 mistral-large-2402
63.77 gpt-3.5-turbo-0301
72.99 01-ai/Yi-34B-Chat
68.51 openchat/openchat-3.5-1210
65.84 garage-bAInd/Platypus2-70B-instruct
72.46 mistralai/Mixtral-8x7B-Instruct-v0.1
75.9 Qwen/Qwen1.5-14B-Chat
39.93 Qwen/Qwen1.5-4B-Chat
62.68 google/gemma-2b-it
61.88 google/gemma-7b-it
60.78 meta-llama/Llama-2-7b-chat-hf
66.55 meta-llama/Llama-2-13b-chat-hf
77.03 sophosympatheia/Midnight-Miqu-70B-v1.5
# normalised:
std_dev 0.5906501984424266
avg_kendalls 0.5857843137254901
avg_pearsons 0.6865766107431969
mean_score 68.91315789473684
range 37.1
std_dev 8.859752976636399
CV 0.1285640253225582
std_dev_top_5 0.7018333135438918
pearson_arena_elo 0.7836064501128717
kendall_arena_elo 0.7142857142857143
pearson_eq_bench 0.797765388448153
kendall_eq_bench 0.676470588235294
pearson_top_8_arena_elo 0.41544558485294697
kendall_top_8_arena_elo 0.3333333333333333
pearson_top_8_eq_bench 0.7494890195588157
kendall_top_8_eq_bench 0.6190476190476191
aggregate_score 62.10037076370378
----judgemark Benchmark Complete----
2024-04-04 20:58:18
Time taken: 222.5 mins
Judge: mistral-medium
Final Judgemark Benchmark Results:
Mean Score: 68.91
Std. Dev.: 8.86
Judgemark Score: 62.1
Cost: $6.08
`;

function setupDarkModeToggle() {
	var toggle = document.getElementById('darkModeToggle');
	var label = document.getElementById('toggleLabel');

	// Check if a preference is saved in localStorage
	const savedMode = localStorage.getItem('darkModeEnabled');
	if (savedMode) {
		 document.body.classList.toggle('dark-mode', savedMode === 'true');
		 toggle.checked = savedMode === 'true';
		 label.textContent = savedMode === 'true' ? 'Dark' : 'Light';
	}

	toggle.addEventListener('change', function() {
		 document.body.classList.toggle('dark-mode', this.checked);         
		 label.textContent = this.checked ? 'Dark' : 'Light';
		 localStorage.setItem('darkModeEnabled', this.checked); // Save preference
	});
}

function applySystemTheme() {
	// Only apply system theme if there's no saved preference
	if (localStorage.getItem('darkModeEnabled') === null) {
		 const prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
		 const toggle = document.getElementById('darkModeToggle');
		 const label = document.getElementById('toggleLabel');

		 document.body.classList.toggle('dark-mode', prefersDarkMode);
		 toggle.checked = prefersDarkMode;
		 label.textContent = prefersDarkMode ? 'Dark' : 'Light';
	}
}

function displayEncodedEmail() {
	var encodedUser = '&#99;&#111;&#110;&#116;&#97;&#99;&#116;';
	var encodedDomain = '&#101;&#113;&#98;&#101;&#110;&#99;&#104;&#46;&#99;&#111;&#109;';
	var emailElement = document.getElementById('email');
	emailElement.innerHTML = decodeHtmlEntities(encodedUser + '&#64;' + encodedDomain);

	var emailAddress = emailElement.innerText;
	emailElement.innerHTML = `<a href="mailto:${emailAddress}">Contact</a>`;
}

function decodeHtmlEntities(encodedString) {
	var textArea = document.createElement('textarea');
	textArea.innerHTML = encodedString;
	return textArea.value;
}

$.fn.dataTable.ext.type.order['params-pre'] = function (data) {
	if (!data || data === '-') {
		return 9999; // Sort missing or null values last
  }
  if (data.includes('x')) {
		const parts = data.split('x').map(Number);
		return parts.reduce((acc, val) => acc * val, 1); // Multiply if in 'x' format
  }
  return parseFloat(data) || 0; // Default to float conversion
};

function loadLeaderboardData() {
	const judgemarkRuns = leaderboardDataJudgemark.split('\n# ').filter(run => run.trim() !== '');

	const maxJudgemarkScore = Math.max(...judgemarkRuns.map(run => {
		const lines = run.split('\n');
		const judgemarkScoreMatch = lines.find(stat => stat.includes('Judgemark Score:'));
		return judgemarkScoreMatch ? parseFloat(judgemarkScoreMatch.split(':')[1].trim()) : 0;
	}));

	let html = judgemarkRuns.map(judgemarkRun => {
		console.log(judgemarkRun)
		if (!(judgemarkRun.trim())) {
			return '';
		}
		const lines = judgemarkRun.split('\n');
		const modelName = lines.find(line => line.startsWith('Judge:')).replace('Judge:', '').trim();

		const normalizedStatsIndex = lines.findIndex(line => line.includes('normalised:'));
		const normalizedStats = lines.slice(normalizedStatsIndex + 1);

		const eqbCorrMatches = normalizedStats.filter(stat => stat.includes('pearson_eq_bench'));
		const eqbCorr = eqbCorrMatches.length > 0 ? (eqbCorrMatches.map(match => parseFloat(match.split(/\s+/)[1])).reduce((sum, val) => sum + val, 0) / eqbCorrMatches.length).toFixed(2) : '-';

		const arenaCorrMatches = normalizedStats.filter(stat => stat.includes('pearson_arena_elo'));
		const arenaCorr = arenaCorrMatches.length > 0 ? (arenaCorrMatches.map(match => parseFloat(match.split(/\s+/)[1])).reduce((sum, val) => sum + val, 0) / arenaCorrMatches.length).toFixed(2) : '-';

		const costMatch = lines.find(stat => stat.includes('Cost:'));
		const cost = costMatch ? '$' + costMatch.split('$')[1].trim() : '-';

		const stdDevMatch = lines.find(stat => stat.includes('Std. Dev.:'));
		const stdDev = stdDevMatch ? stdDevMatch.split(':')[1].trim() : '-';

		const judgemarkScoreMatch = lines.find(stat => stat.includes('Judgemark Score:'));
		const judgemarkScore = judgemarkScoreMatch ? judgemarkScoreMatch.split(':')[1].trim() : '-';

		// Extract model name without creator
		let displayModelName = modelName;
		let modelNameDisplay = displayModelName.includes('/')
			? `<a href="https://huggingface.co/${displayModelName}" target="_blank">${displayModelName.split('/').pop()}</a>`
			: displayModelName;

		let modelStatsFn = 'results/judgemark/' + displayModelName.replace('/', '__') + '.txt';

		const judgemarkScorePercentage = (parseFloat(judgemarkScore) / maxJudgemarkScore) * 100;

		const judgemarkScoreBar = `
			<div class="score-bar-container">
				<div class="judgemark-score-bar" style="width: ${judgemarkScorePercentage}%"></div>
				<span class="score-text">${judgemarkScore}</span>
			</div>
		`;

		return `<tr>
			<td>${modelNameDisplay}</td>
			<td>${eqbCorr}</td>
			<td>${arenaCorr}</td>
			<td>${cost}</td>
			<td>${stdDev}</td>
			<td data-order="${judgemarkScore}">${judgemarkScoreBar}</td>
			<td><a href="${modelStatsFn}">Stats</a></td>
			</tr>`;
	}).join('');

	document.getElementById('leaderboardBody').innerHTML = html;
	initializeDataTable();
}

function initializeDataTable() {
	let table = $('#leaderboard').DataTable({
		"order": [[5, "desc"]], // Default sorting
		"pageLength": 100,
		"lengthMenu": [50, 100, 200, 1000],
		"language": {
			"lengthMenu": "Show _MENU_"
		},
		"columnDefs": [
			{ "targets": [5], "orderSequence": ["desc", "asc"] }, // For Judgemark score column: sort desc first
			{ "targets": [4, 3], "orderSequence": ["asc", "desc"] }, // For Std. Dev. and Cost columns: sort asc first
		],
		"dom": "<'d-flex flex-column flex-md-row justify-content-between'<'dataTables_length'l><'dataTables_filter'f>>" +
			"<'row'<'col-12'tr>>" +
			"<'row'<'col-md-5'i><'col-md-7'p>>",
		"drawCallback": function(settings) {
			const api = this.api();
			const rows = api.rows({ page: 'current' }).nodes();
			const sortedColumnIndex = api.order()[0][0];

			if (sortedColumnIndex === 5) {
				// Show score bars for the Judgemark column
				rows.to$().find('.judgemark-score-bar').css('display', 'block');
			} else {
				// Hide score bars for other columns
				rows.to$().find('.judgemark-score-bar').css('display', 'none');
			}
		}
	});
}

document.addEventListener('DOMContentLoaded', function() {
	// Always execute
	displayEncodedEmail();

	// Conditional execution based on the presence of elements
	if (document.getElementById('leaderboard')) {
		loadLeaderboardData(); // Only load leaderboard data if the leaderboard element exists
	}

	// This checks if the system theme preference should be applied, which is common functionality
	applySystemTheme();
	setupDarkModeToggle();
});